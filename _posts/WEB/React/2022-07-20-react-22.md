---
title: "[React] useReaducer"
excerpt: "[React] useReaducer"
categories: [React]
tags: [React, WEB]
toc: true
toc_sticky: true
---

## ğŸ’ ìƒíƒœ ë³€í™” ë¡œì§ ë¶„ë¦¬í•˜ê¸°

- count: state
- dispatch: ìƒíƒœë¥¼ ë³€í™”ì‹œí‚¤ëŠ” ì•¡ì…˜ì„ ì¼ìœ¼í‚¤ëŠ” í•¨ìˆ˜ -> type í”„ë¡­ì´ ë“¤ì–´ìˆëŠ” ê°ì²´ë¥¼ ì „ë‹¬
- reducer: ìƒíƒœ ë³€í™”ë¥¼ ì²˜ë¦¬í•´ì£¼ëŠ” í•¨ìˆ˜

ì´ ê°ì²´ëŠ” ìƒíƒœì— ëŒ€í•œ ê°ì²´ì´ë‹¤.

total Code

```jsx
import "./App.css";
import { useRef, useEffect, useMemo, useCallback, useReducer } from "react";
import DiaryEditor from "./DiaryEditor";
import DiaryList from "./DiaryList";

const reducer = (state, action) => {
  switch (action.type) {
    case "INIT": {
      return action.data;
    }
    case "CREATE": {
      const created_date = new Date().getTime();
      const newItem = {
        ...action.data,
        created_date,
      };
      return [newItem, ...state];
    }
    case "REMOVE": {
      return state.filter((it) => it.id !== action.targetId);
    }

    case "EDIT": {
      return state.map((it) =>
        TimeRanges.id === action.targetId
          ? { ...it, content: action.newContent }
          : it
      );
    }

    default:
      return state;
  }
};
function App() {
  // const [data, setData] = useState([]);

  const [data, dispatch] = useReducer(reducer, []);

  const dataId = useRef(0);

  /* ìƒˆë¡œìš´ ë¦¬ìŠ¤íŠ¸ ì¶”ê°€ */
  const onCreate = useCallback((author, content, emotion) => {
    dispatch({
      type: "CREATE",
      data: { author, content, emotion, id: dataId.current },
    });

    dataId.current += 1;
  }, []);

  /* ê¸°ì¡´ ì¶”ê°€ëœ ë¦¬ìŠ¤íŠ¸ ì‚­ì œ */
  const onRemove = (targetId) => {
    dispatch({ type: "REMOVE", targetId });
  };

  /* ë°ì´í„° ìˆ˜ì • */
  const onEdit = (targetId, newContent) => {
    dispatch({ type: "EDIT", targetId, newContent });
  };

  /* API í˜¸ì¶œí•˜ê¸° */
  const getData = async () => {
    const res = await fetch(
      "https://jsonplaceholder.typicode.com/comments"
    ).then((res) => res.json());

    const initData = res.slice(0, 20).map((it) => {
      return {
        author: it.email,
        content: it.body,
        emotion: Math.floor(Math.random() * 5) + 1,
        created_date: new Date().getTime(),
        id: dataId.current++,
      };
    });
    dispatch({ type: "INIT", data: initData });
  };

  // Mount ì‹œì ì— ìˆ˜í–‰
  useEffect(() => {
    getData();
  }, []);

  /* emotion ì ìˆ˜ ì¹´ìš´íŒ… */
  const getDiaryAnalysis = useMemo(() => {
    const goodCount = data.filter((it) => it.emotion >= 3).length;
    const badCount = data.length - goodCount;
    const goodRatio = (goodCount / data.length) * 100;
    return { goodCount, badCount, goodRatio };
  }, [data.length]);

  const { goodCount, badCount, goodRatio } = getDiaryAnalysis;

  return (
    <div className="App">
      <h1>ì¼ê¸°ì¥</h1>
      <DiaryEditor onCreate={onCreate}></DiaryEditor>
      <div className="diaryAnalysis">
        <h2> ì „ì²´ ì¼ê¸° : {data.length}</h2>
        <div>ê¸°ë¶„ ì¢‹ì€ ì¼ê¸° ê°œìˆ˜ : {goodCount}</div>
        <div>ê¸°ë¶„ ë‚˜ìœ ì¼ê¸° ê°œìˆ˜ : {badCount}</div>
        <div>ê¸°ë¶„ ì¢‹ì€ ì¼ê¸° ë¹„ìœ¨ : {goodRatio}% </div>
      </div>
      <DiaryList
        diaryList={data}
        onRemove={onRemove}
        onEdit={onEdit}
      ></DiaryList>
    </div>
  );
}

export default App;
```

### ğŸ”† ì½”ë“œ ë¶„ì„

ê¸°ì¡´ì— useStateë¥¼ ì‚¬ìš©í•´ì„œ stateê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ dataë¥¼ ë³€ê²½ì‹œì¼œì£¼ì–´ì„œ ì‚¬ìš©í–ˆë‹¤. ê·¸ë˜ì„œ ì´ë ‡ê²Œ ì‚¬ìš©í•œ í•¨ìˆ˜ê°€ _onCreate, onRemove, onEdit, getData_ ê°€ ìˆë‹¤.

í•˜ë‚˜ì˜ ì»´í¬ë„ŒíŠ¸ì— ì—¬ëŸ¬ê°œì˜ í•¨ìˆ˜ë“¤ì´ ì—­í• ì„ í•œë‹¤ëŠ” ê²ƒì€ ê·¸ë‹¥ ì¢‹ì§€ ì•Šìœ¼ë¯€ë¡œ useReducerë¥¼ ì‚¬ìš©í•´ì„œ ì—­í• ì„ ë¶„ë¦¬í•´ì£¼ëŠ” ê²ƒì´ë‹¤.
=> then HOW?

ê¸°ì¡´ useStateìë¦¬ì—

```jsx
const [data, dispatch] = useReducer(reducer, []);
```

ìœ¼ë¡œ ë³€ê²½ì‹œì¼œì¤€ë‹¤. ì§„í–‰ê³¼ì •ì€ dispatchë¥¼ í†µí•´ì„œ ì–´ë–¤ typeì¸ì§€ ì•¡ì…˜ ê°ì²´ê°€ reducerë¡œ ì „ë‹¬ì´ ë˜ê³ , ê±°ê¸°ì„œ ë¦¬í„´ëœ ê°’ì´ dataë¡œ ë„˜ì–´ê°€ëŠ” í˜•ì‹ì´ë‹¤.

```jsx
const reducer = (state, action) => {
  switch (action.type) {
    case "INIT": {
      return action.data;
    }
    case "CREATE": {
      const created_date = new Date().getTime();
      const newItem = {
        ...action.data,
        created_date,
      };
      return [newItem, ...state];
    }
    case "REMOVE": {
      return state.filter((it) => it.id !== action.targetId);
    }

    case "EDIT": {
      return state.map((it) =>
        TimeRanges.id === action.targetId
          ? { ...it, content: action.newContent }
          : it
      );
    }

    default:
      return state;
  }
};
```

stateëŠ” í˜„ì¬ ë³€ê²½ë˜ê¸° ì „ stateë¥¼ ë§í•˜ê³ , actionì€ action ê°ì²´ë¥¼ ë§í•œë‹¤. ê¸°ì¡´ì˜ í•¨ìˆ˜ë“¤ì—ì„œ ì‚¬ìš©ë˜ì—ˆë˜ ë³€ìˆ˜ë“¤ì„ action ê°ì²´ë¥¼ í†µí•´ì„œ ì „ë‹¬í•´ì£¼ë©´ ëœë‹¤.
