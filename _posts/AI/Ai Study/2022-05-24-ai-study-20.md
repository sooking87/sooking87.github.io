---
title: "[chap 8-3] í•©ì„±ê³± ì‹ ê²½ë§ì˜ ì‹œê°í™”"
excerpt: "[chap 8-3] í•©ì„±ê³± ì‹ ê²½ë§ì˜ ì‹œê°í™”"
categories: [Ai Study]
tags: [Ai Study, Python]
toc: true
toc_sticky: true
---

## ğŸ”® ê°€ì¤‘ì¹˜ ì‹œê°í™”

ê°€ì¤‘ì¹˜ëŠ” ì…ë ¥ ì´ë¯¸ì§€ì˜ 2ì°¨ì› ì˜ì—­ì— ì ìš©ë˜ì–´ ì–´ë–¤ íŠ¹ì§•ì„ í¬ê²Œ ë‘ë“œëŸ¬ì§€ê²Œ í‘œí˜„í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

### ğŸ“ ê°€ì¤‘ì¹˜ë¥¼ ì‹œê°í™”í•˜ê¸°

ğŸ“Œ í›ˆë ¨í•œ ëª¨ë¸ì˜ ê°€ì¤‘ì¹˜ í‘œí˜„

```python
from tensorflow import keras
# ì½”ë©ì—ì„œ ì‹¤í–‰í•˜ëŠ” ê²½ìš°ì—ëŠ” ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ best-cnn-model.h5 íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œë°›ì•„ ì‚¬ìš©í•˜ì„¸ìš”.
!wget https://github.com/rickiepark/hg-mldl/raw/master/best-cnn-model.h5
model = keras.models.load_model('best-cnn-model.h5')

model.layers

>>>
[<keras.layers.convolutional.Conv2D at 0x7ff6ae771150>,
 <keras.layers.pooling.MaxPooling2D at 0x7ff6ae771d90>,
 <keras.layers.convolutional.Conv2D at 0x7ff6ae771590>,
 <keras.layers.pooling.MaxPooling2D at 0x7ff6ae698910>,
 <keras.layers.core.flatten.Flatten at 0x7ff6ae69e190>,
 <keras.layers.core.dense.Dense at 0x7ff6ae6984d0>,
 <keras.layers.core.dropout.Dropout at 0x7ff6ae6a2450>,
 <keras.layers.core.dense.Dense at 0x7ff6ae69e210>]
```

8-2ì¥ì—ì„œ ì‚¬ìš©í–ˆë˜ ëª¨ë¸ì˜ ì¸µì´ ê·¸ëŒ€ë¡œ ë‚˜ì™€ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ê° ì¸µì˜ ê°€ì¤‘ì¹˜ì™€ ì ˆí¸ì€ ì¸µì˜ weights ì†ì„±ì— ì €ì¥ë˜ì–´ ìˆë‹¤. -> ì–˜ëŠ” íŒŒì´ì¬ ë¦¬ìŠ¤íŠ¸ì„
<br>

ì´ weights ì†ì„±ì„ ì¡°ê¸ˆ ì‰½ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ë„˜íŒŒì´ ë°°ì—´ë¡œ ë³€ê²½ì‹œì¼œì„œ ê°€ì¤‘ì¹˜ë¥¼ ì‹œê°í™” ì‹œì¼°ë‹¤.

```python
conv = model.layers[0]

# ì²« ë²ˆì§¸ ì¸µ: í•©ì„±ì¸µ
conv_weights = conv.weights[0].numpy()
print(conv_weights.mean(), conv_weights.std()) # -0.021033935 0.23466988

# ê°€ì¤‘ì¹˜ ê·¸ë¦¬ê¸°
import matplotlib.pyplot as plt
plt.hist(conv_weights.reshape(-1, 1))
plt.xlabel('weights')
plt.ylabel('count')
plt.show()
```

![download1](https://user-images.githubusercontent.com/96654391/170075371-f3b5c3d8-0deb-432e-800c-9b7c4cfa262b.png)

<br>

ê°€ì¤‘ì¹˜ê°€ 0ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì¢…ëª¨ì–‘ì˜ ë¶„í¬ë¥¼ ë ê³  ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. -> ì´ ê°€ì¤‘ì¹˜ê°€ ë¬´ì—‡ì„ ì˜ë¯¸í•˜ëŠ”ê°€?

```python
fig, axs = plt.subplots(2, 16, figsize=(15, 2))
for i in range(2):
  for j in range(16):
    axs[i, j].imshow(conv_weights[:, :, 0, i*16 + j], vmin=-0.5, vmax=0.5)
    axs[i, j].axis('off')
plt.show()
```

![download2](https://user-images.githubusercontent.com/96654391/170075816-7d26cc9c-76a6-48a4-8802-03c516ee86a2.png) <br>

32ê°œì˜ ì»¤ë„ì˜ ê°€ì¤‘ì¹˜ë¥¼ ì¶œë ¥í•œ ëª¨ìŠµ
<br> <br>

ğŸ“Œ í›ˆë ¨í•˜ì§€ ì•Šì€ ëª¨ë¸ì˜ ê°€ì¤‘ì¹˜ í‘œí˜„

```python
no_training_model = keras.Sequential()
no_training_model.add(keras.layers.Conv2D(32, kernel_size=3, activation='relu', padding='same', input_shape=(28, 28, 1)))

no_training_conv = no_training_model.layers[0]
no_training_weights = no_training_conv.weights[0].numpy()

plt.hist(no_training_weights.reshape(-1, 1))
plt.xlabel('weights')
plt.ylabel('count')
plt.show()
```

![download2](https://user-images.githubusercontent.com/96654391/170076685-602461fb-1788-4377-861e-c717e529ba23.png) <br>

ì´ˆê¸° í›ˆë ¨í•˜ì§€ ì•Šì€ ëª¨ë¸ì˜ ê²½ìš° ê°€ì¤‘ì¹˜ëŠ” ê· ë“± ë¶„í¬ì—ì„œ ëœë¤í•˜ê²Œ ê°’ì„ ì„ íƒí•˜ì—¬ ë¹„êµì  ê³ ë¥¸ ë¶„í¬ë¥¼ ë³´ì…ë‹ˆë‹¤.

```python
fig, axs = plt.subplots(2, 16, figsize=(15, 2))
for i in range(2):
  for j in range(16):
    axs[i, j].imshow(no_training_weights[:, :, 0, i*16 + j], vmin=-0.5, vmax=0.5)
    axs[i, j].axis('off')
plt.show()
```

![download3](https://user-images.githubusercontent.com/96654391/170076983-79f0ea4b-f318-4729-9b8c-12e7546d2f97.png)

<br>

ì»¤ë„ì˜ ê°€ì¤‘ì¹˜ ì—­ì‹œ ì „ë°˜ì ìœ¼ë¡œ ê³ ë¥¸ ìƒ‰ì„ ë„ìš°ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. -> ë”°.ë¼.ì„œ í•©ì„±ê³± ì‹ ê²½ë§ì´ íŒ¨ì…˜ MNIST ë°ì´í„°ì…‹ì˜ ë¶„ë¥˜ ì •í™•ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ ìœ ìš©í•œ íŒ¨í„´ì„ í•™ìŠµí–ˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

### ğŸ“ íŠ¹ì„± ë§µ ì‹œê°í™”í•˜ê¸°

```python
inputs = keras.Input(shape=(784, ))
hidden = dense(inputs) # ì²« ë²ˆì§¸ ì¸µ
outputs = dense2(hidden) # ë‘ ë²ˆì§¸ ì¸µ
model = keras.Model(input, outputs) # ì¶œë ¥ì¸µê¹Œì§€ ì—°ê²°
```

ì´ëŸ°ì‹ìœ¼ë¡œ í•¨ìˆ˜í˜• APIê°€ ì‚¬ìš©ì´ ë˜ëŠ”ë° ì™œ ì´ê²Œ ê°€ì¤‘ì¹˜ë¥¼ ì‹œê°í™”í•˜ëŠ”ë° í•„ìš”í•˜ëƒë©´ ì‹œê°í™”í•˜ê¸°ìœ„í•´ì„œëŠ” ì¶œë ¥ì¸µì˜ ê°€ì¤‘ì¹˜ê°€ í•„ìš”í•œ ê²ƒì´ ì•„ë‹Œ, ì²« ë²ˆì§¸ ì¸µ, ë‘ ë²ˆì§¸ ì¸µ ë“±ì˜ ì¤‘ê°„ì— ìˆëŠ” ì¸µì˜ íŠ¹ì„± ë§µì´ í•„ìš”í•˜ë‹¤. ì´ë•Œ, output ì†ì„±ì„ ì‚¬ìš©í•´ì„œ íŠ¹ì„± ë§µì„ ì–»ì„ ìˆ˜ ìˆë‹¤.
<br>

í•¨ìˆ˜í˜• APIë¥¼ ì‚¬ìš©í•´ì„œ íŠ¹ì„± ë§µ ì‹œê°í™” í•˜ê¸°!

```python
conv_acti = keras.Model(model.input, model.layers[0].output)

(train_input, train_target), (test_input, test_target) = keras.datasets.fashion_mnist.load_data()
plt.imshow(train_input[0], cmap='gray_r')
plt.show()
```

![download1](https://user-images.githubusercontent.com/96654391/170079308-097312e5-68d0-4892-b6b8-321a37608b95.png)

ì‹ ë°œì— ëŒ€í•œ ê°€ì¤‘ì¹˜ë¥¼ ì‹œê°í™” í•´ë³¼ ì˜ˆì • <br>

```python
inputs = train_input[0:1].reshape(-1, 28, 28, 1) / 255.0
feature_maps = conv_acti.predict(inputs)
print(feature_maps.shape)

>>> (1, 28, 28, 32)
```

í•©ì„±ê³± ì¸µì„ outputìœ¼ë¡œ ê°€ì§„ ëª¨ë¸ì„ ì´ìš©í•˜ì—¬ì„œ ë¶€ì¸ ì— ëŒ€í•œ íŠ¹ì„± ë§µì„ ë§Œë“¤ì—ˆë‹¤.

```python
fig, axs = plt.subplots(4, 8, figsize=(15, 8))
for i in range(4):
  for j in range(8):
    axs[i, j].imshow(feature_maps[0, :, :, i * 8 + j])
    axs[i, j].axis('off')
plt.show()
```

![download2](https://user-images.githubusercontent.com/96654391/170080101-c01c9711-25ac-40e4-9538-2b26dfa926df.png)

32ê°œì˜ í•„í„°ë¡œ ì¸í•´ì„œ ì…ë ¥ ì´ë¯¸ì§€ì—ì„œ ê°•í•˜ê²Œ í™œì„±í™”ëœ ë¶€ë¶„ì„ ë³´ì—¬ì¤€ë‹¤. ì•ì—ì„œ ì¶œë ¥í•´ë³´ì•˜ë˜ í•„í„°ê°€ ê°ì§€í•œ ìƒ‰ìƒì´ ê°•í•˜ê²Œ í™œì„±í™”ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```python
conv2_acti = keras.Model(model.input, model.layers[2].output)
feature_maps = conv2_acti.predict(train_input[0:1].reshape(-1, 28, 28, 1)/255.0)

fig, axs = plt.subplots(8, 8, figsize=(12, 12))
for i in range(8):
  for j in range(8):
    axs[i, j].imshow(feature_maps[0, :, :, i * 8 + j])
    axs[i, j].axis('off')
plt.show()
```

![download3](https://user-images.githubusercontent.com/96654391/170081454-0cdea561-ac40-4128-84f7-6fab770c43cf.png)

ë‘ ë²ˆì§¸ í•©ì„±ê³± ì¸µì˜ í•„í„° ê°œìˆ˜ëŠ” 64ê°œì´ë¯€ë¡œ ì¶œë ¥í•  ìˆ˜ ìˆëŠ” íŠ¹ì„± ë§µ ì—­ì‹œ 64ê°œì„ì„ ì•Œ ìˆ˜ ìˆë‹¤. ë‘ ë²ˆì§¸ í•©ì„±ê³± ì¸µì˜ 64ê°œì˜ í•„í„°ê°€ ì•ì„œ ì¶œë ¥í•œ 32ê°œì˜ íŠ¹ì„± ë§µê³¼ ê°ê° ê³±í•´ì ¸ ë‘ ë²ˆì§¸ í•©ì„±ê³± ì¸µì˜ outputì´ ë˜ëŠ”ë°, íŠ¹ì„± ë§µì—ì„œ ì–´ë–¤ ë¶€ìœ„ë¥¼ ê°ì§€í•˜ëŠ”ì§€ ì§ê´€ì ìœ¼ë¡œ ì´í•´í•˜ê¸° ì–´ë µë‹¤. ì¦‰, ì•ë¶€ë¶„ì— ìˆëŠ” í•©ì„±ê³± ì¸µì€ ì´ë¯¸ì§€ì˜ ì‹œê°ì ì¸ ì •ë³´ë¥¼ ê°ì§€í•˜ê³  ë’¤ìª½ì— ìˆëŠ” í•©ì„±ê³± ì¸µì€ ì•ìª½ì—ì„œ ê°ì§€í•œ ì‹œê°ì ì¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¶”ìƒì ì¸ ì •ë³´ë¥¼ í•™ìŠµí•œë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.
